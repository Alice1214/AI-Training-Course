## Action3
**如果你是某P2P租车的技术负责人，你会如何设计个性化推荐和搜索排序：
阐述相似车型，搜索排序的设计方法；阐述可能的embedding策略？**

答：P2P租车是一个短期租赁双边平台，车主有可能拒绝出租，买卖双方的体验都需要考虑到。另外，一个顾客很少会预定同一台车多次，一台车在某时间段内只能被一个顾客租用，数据存在严重的稀疏性。

（1）相似车型、搜索排序的设计方法：

embedding：将每辆车都映射到一个车辆embedding。相似车型与搜索排序模块都需要用到这个部分。具体见（2）中内容。

相似车型推荐模块：每个车辆详情页面都包含一个「相似车辆」的轮播，推荐与当前车辆相似并且可以在相同时间段内预订的车辆。主要方法是获取用户最近点击的车辆，以及的车辆候选列表，用户最终预订的车辆；计算点击车辆和候选车辆在embedding空间的余弦相似度；将那些相似度最高的且可以被用户租用的车辆推荐给用户。

搜索排序模块：当用户使用自己的个人信息和意愿进行搜索时，其将返回给用户最匹配的车辆序列，越匹配的放在越前面。这里的搜索排序问题可以转化为一个pairwise regression问题，需要构建数据集并使用Lambda Rank算法进行训练。其中输入特征包括listing features、user features、query features和cross features以及embedding features。

冷启动：当车主上传新车源时需要上传3个基本特征，位置，价格，车辆类型（包括几座、品牌等车辆基本信息），在和新上传车辆具有相同类型和相同价格区间的车源中，找到3个地理位置最接近的车源，用这3个车源的embedding求平均作为新车源的embedding，这样新车源也可以被推荐了。

（2）embedding策略：

List Embedding：将用户的点击序列切分成会话 (Session) ，其中每个会话定义为一个由用户点击的 M个车源 id 组成的的不间断序列，只要用户连续两次点击时间间隔超过30分钟，就认为是一个新的Session；通过集合会话S，学习出每个车源listing的d维embedding表示，让相似listing在embedding空间中距离更近。这里可借鉴word2vec中的skip-gram算法：把每个用户连续点击过的房源Session看做一个句子，每个车源当做word，训练出车源的embedding；List Embedding的目标函数采用negative sampling构造采样之后的目标函数。（这里有几个小技巧：1）把session中被预定的listing作为一个全局的上下文始终出现在每次的滑动窗口中，提高booking权重；2）全局负采样、同地区负采样。）

user-type&listing-type embeddings：分别对拥有一些相同基础属性和相同行为的用户/车源进行分桶，用type来表示原有的user和listing，按分桶后的数据进行学习embedding，在更高一个维度（粗粒度）上获取长期兴趣。

